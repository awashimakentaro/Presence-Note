# AGENTS.md

このドキュメントは、本プロジェクトに関わる「エージェント」の定義と、
各エージェントが **必ず守るべき責務・制約・開発ルール** を明確にするものである。

Codex CLI を含む **すべての AI エージェントは、変更・実装・提案を行う前に
必ず本ファイルを読み、遵守しなければならない。**

---

## 0. 本ドキュメントの位置づけ

本 AGENTS.md は、本プロジェクト v1 における **最上位の行動規範・開発規約** を定義する。

* 本ドキュメントは、設計書・要件定義書よりも優先される
* 将来（v2 以降）で改訂される可能性はある
* ただし **暗黙的・無断での無視・上書きは禁止**
* 変更が必要な場合は、必ず本ドキュメントを更新すること

---

## 1. 本プロジェクトにおける「エージェント」の定義

本プロジェクトにおける「エージェント」とは、

**自律的に振る舞うソフトウェア上の構成要素**
（常駐プロセス・監視処理・自動実行ロジック）を指す。

人間（送信者・受信者・設置者）はエージェントとはみなさず、
**設計上の前提条件・制約としてのみ扱う。**

---

## 2. 人の役割（非エージェント）

* 画像・メッセージの送信者
* デバイス設置者（ラズパイ・プリンタ）
* 受信結果の閲覧者

人は：
* 状態を持たない
* 自動処理を行わない
* システム内部の判断ロジックに関与しない

---

## 3. システムエージェント（主要）

### 3.1 Receiver Agent
* ntfy 等を通じて外部からデータを受信する
* データの内容解釈は行わない
* 正常／異常の判定のみを行う

### 3.2 Processor Agent
* 受信データを **印刷可能な形式に変換** する
* レイアウト・意味解釈・生成は行わない
* 入力 → 出力の純粋変換のみを担う

### 3.3 Printer Agent
* OS / CUPS 経由でプリンタに出力する
* 印刷成功／失敗のみを扱う
* 再印刷判断は行わない

---

## 4. グローバルルール（v1 固定）

以下は **v1 において絶対に行ってはならない**：

* 永続化しない（DB・ファイル保存）
* 履歴を持たない
* 分析・統計を行わない
* ユーザーモデリングを行わない
* 評価・スコアリングを行わない
* 意味理解・内容解釈を行わない
* 失敗時にユーザーへ能動的通知を行わない

失敗は **静かに・安全に・破壊せず** 処理する。

---

## 5. AI エージェント向けルール（Codex 等）

AI エージェントは以下を **必須で遵守** すること：

* AGENTS.md / 設計書.md / 要件定義書.md を必ず読む
* v1 の制約を厳密に守る
* 明示されていない機能追加を行わない
* 以下を導入する前には **必ず人間に確認を取る**

  * 状態管理
  * 永続化
  * 再試行・リトライ
  * 条件分岐による振る舞い変更
  * ユーザー向けロジック

---

## 6. 将来改訂（v2 以降）

* 本ドキュメントは将来改訂されうる
* 改訂は以下を満たす必要がある

  * 明示的であること
  * 意図的であること
  * ドキュメント化されていること

AGENTS.md は不変ではないが、
**宣言されたバージョンにおいて常に最終的な権威を持つ。**

---

## 7. 開発・実装ルール（最重要）

本セクションは **人間・AI を問わず強制適用** される。

---

### 7.1 ファイル単位のドキュメント化（必須）

**すべてのファイルの先頭に、日本語で以下を明記すること。**

* このファイルの責務
* 使用されるエージェント／処理フロー
* やらないこと（責務外）
* 他ファイルとの関係

#### 例

```python
"""
printer_agent.py

【責務】
印刷可能なデータを OS / CUPS 経由でプリンタに送信する。

【使用箇所】
- Processor Agent の出力を受け取る。

【やらないこと】
- データ変換
- 再試行判断
- 印刷内容の解釈

【補足】
プリンタ依存処理はこのファイルに閉じ込める。
"""
```

## 7.2 関数・メソッド単位のドキュメント化（必須）

**すべての関数・メソッドには、日本語によるドキュメントコメントを必ず付与すること。**

最低限、以下の情報を含める：

* この関数は何をするか
* どこから呼び出されるか
* 入力と出力の意味
* 副作用の有無（状態変更・I/O 等）

ドキュメントコメントが存在しない関数は、
**未完成・未レビュー・実装違反**とみなす。

---

## 7.3 SRP（単一責務原則）の厳守（強制）

以下を **絶対ルール** とする：

* **1 ファイル = 1 つの責務**
* **1 クラス = 1 つの役割**
* **1 関数 = 1 つの処理**

以下の実装は明確に禁止する：

* 複数責務を持つ関数・クラス
* 条件分岐によって役割が変わる実装
* 「ついでに行う」処理の追加
* 汎用化しすぎたユーティリティの肥大化

判断に迷った場合は、
**分割することを常に優先する。**

---

## 7.4 SRP 違反の判断基準

以下のいずれかに該当した場合、
その実装は **SRP 違反** とみなす：

* 関数名・メソッド名に複数の動詞的意味が含まれる
* 説明文に「〜しつつ」「場合によって」「ついでに」が頻出する
* テスト観点が複数存在する
* 呼び出し元が複数の意図を期待している

SRP 違反は **設計上の欠陥** であり、
リファクタリング対象とする。

---

## 7.5 AI エージェントへの追加制約

AI エージェント（Codex 等）は、以下を必ず守ること：

* ドキュメントコメントを省略してはならない
* SRP を理由とした分割を躊躇してはならない
* 行数削減のために説明を削ってはならない

**可読性と意図の明示は、コードの短さより常に優先される。**

---

## 8. このルールの目的

本ルールの目的は、以下に集約される：

* 将来の自分が、即座に理解できる状態を保つため
* AI による設計逸脱・意味の崩壊を防ぐため
* 感情的・個人的価値を持つプロジェクトを破壊しないため

**本プロジェクトは、単なる機能の集合ではない。  
設計思想そのものを保存するための構造体である。**

---
